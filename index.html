<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATMM.AIçˆ±åŒç›Ÿå®‡å®™AIåŠ©æ‰‹</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, sans-serif;
            background: #f0f2f5;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        .navbar {
            background: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 100;
        }
        .nav-left { display: flex; align-items: center; gap: 10px; }
  .logo-img { 
    width: 60px;   /* å»ºè®®ä» 40px æ”¹å¤§åˆ° 60pxï¼Œå› ä¸ºä½ çš„ Logo ç»†èŠ‚å¾ˆå¤š */
    height: 60px; 
    background: transparent; /* å»æ‰åŸæœ¬çš„ linear-gradient è“è‰²èƒŒæ™¯ */
    display: flex; 
    align-items: center; 
    justify-content: center; 
    cursor: pointer;
    overflow: hidden; /* ç¡®ä¿å›¾ç‰‡ä¸ä¼šè¶…å‡ºåœ†è§’è¾¹æ¡† */
}
        }
        .nav-title { font-size: 18px; font-weight: bold; color: #333; }
        .admin-link { font-size: 14px; color: #0072ff; text-decoration: none; }

        /* ä¸ŠåŠéƒ¨åˆ†ï¼šAI å¯¹è¯æ¡† (å  50%) */
        .ai-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            margin: 15px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .section-header { padding: 10px 15px; background: #f8f9fa; border-bottom: 1px solid #eee; font-weight: 600; }
        .chat-container { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .chat-input-area { padding: 15px; border-top: 1px solid #eee; display: flex; gap: 10px; }
        .chat-input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 6px; outline: none; }
        .send-btn { background: #0072ff; color: white; border: none; padding: 0 20px; border-radius: 6px; cursor: pointer; }

        /* ä¸‹åŠéƒ¨åˆ†ï¼šæ–°é—»èµ„è®¯ (å  50%) */
        .news-section {
            flex: 1;
            margin: 0 15px 15px 15px;
            background: white;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        .news-list { flex: 1; overflow-y: auto; padding: 15px; }
        .news-item { padding: 12px; border-bottom: 1px solid #f0f0f0; }
        .news-item:last-child { border-bottom: none; }
        .news-title { font-weight: 600; color: #333; margin-bottom: 5px; display: block; }
        .news-date { font-size: 12px; color: #999; }

        /* æ°”æ³¡æ ·å¼ */
        .msg { max-width: 80%; padding: 10px; border-radius: 8px; font-size: 14px; line-height: 1.5; }
        .msg.user { align-self: flex-end; background: #0072ff; color: white; }
        .msg.bot { align-self: flex-start; background: #e9ecef; color: #333; }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="nav-left">
           <div class="logo-img" onclick="location.href='admin-unified.html'" style="background: none;">
    <img src="ATMM.AI-1.jpg" alt="Logo" style="width: 100%; height: 100%; object-fit: contain;">
</div>
            <div class="nav-title">ATMM.AIçˆ±åŒç›Ÿå®‡å®™AIåŠ©æ‰‹</div>
        </div>
        <a href="admin-unified.html" class="admin-link">ç®¡ç†å‘˜åå° â†’</a>
    </nav>

    <section class="ai-section">
        <div class="section-header">ğŸ¤– AI æ™ºèƒ½é—®ç­”</div>
        <div class="chat-container" id="chatBox">
            <div class="msg bot">æ‚¨å¥½ï¼æˆ‘æ˜¯ ATMM.AIçˆ±åŒç›Ÿå®‡å®™AIåŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨çš„ï¼Ÿ</div>
        </div>
        <div class="chat-input-area">
            <input type="text" class="chat-input" id="userInput" placeholder="è¯·è¾“å…¥æ‚¨çš„é—®é¢˜...">
            <button class="send-btn" onclick="sendMessage()">å‘é€</button>
        </div>
    </section>

    <section class="news-section">
        <div class="section-header">ğŸ“° åŠ¨æ€æ–°é—»èµ„è®¯</div>
        <div class="news-list" id="newsList">
            <p style="text-align:center; color:#999; padding:20px;">æ­£åœ¨è·å–æœ€æ–°èµ„è®¯...</p>
        </div>
    </section>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        // åˆå§‹åŒ– Supabase (ä½¿ç”¨ä½ ç°æœ‰çš„é…ç½®)
        const SUPABASE_URL = 'https://hrnedqrnzqseuuxmegsb.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhybmVkcXJuenFzZXV1eG1lZ3NiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY4NDc5NzgsImV4cCI6MjA1MjQyMzk3OH0.xvlk4y_xDK5UhRo2JUv0QEXD1fFD-f_NsFwfz5TRN0Y';
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // åŠ è½½åŠ¨æ€æ–°é—» (åªåŠ è½½å·²å®¡æ ¸é€šè¿‡çš„)
        async function fetchNews() {
            const { data, error } = await supabase
                .from('news')
                .select('*')
                .eq('status', 'approved')
                .order('created_at', { ascending: false });

            const newsDiv = document.getElementById('newsList');
            if (data && data.length > 0) {
                newsDiv.innerHTML = data.map(item => `
                    <div class="news-item">
                        <span class="news-title">${item.title}</span>
                        <span class="news-date">${new Date(item.created_at).toLocaleDateString()}</span>
                    </div>
                `).join('');
            } else {
                newsDiv.innerHTML = '<p style="color:#999; text-align:center;">æš‚æ— å‘å¸ƒçš„æ–°é—»</p>';
            }
        }

        // ç®€å•çš„å¯¹è¯é€»è¾‘ (åæœŸå¯å¯¹æ¥ä½ çš„ AI æ¥å£)
        window.sendMessage = function() {
            const input = document.getElementById('userInput');
            const chatBox = document.getElementById('chatBox');
            if (!input.value.trim()) return;

            // ç”¨æˆ·æ¶ˆæ¯
            const userMsg = document.createElement('div');
            userMsg.className = 'msg user';
            userMsg.textContent = input.value;
            chatBox.appendChild(userMsg);

            // æ¨¡æ‹Ÿ AI å›å¤
            setTimeout(() => {
                const botMsg = document.createElement('div');
                botMsg.className = 'msg bot';
                botMsg.textContent = "æ”¶åˆ°æ‚¨çš„é—®é¢˜ï¼Œæ­£åœ¨ä¸ºæ‚¨æŸ¥è¯¢ ATMM æ•°æ®åº“...";
                chatBox.appendChild(botMsg);
                chatBox.scrollTop = chatBox.scrollHeight;
            }, 500);

            input.value = '';
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // åˆå§‹åŒ–
        fetchNews();
    </script>
 <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

    // 1. é…ç½®ä½ çš„ Supabase å‡­æ®
    const SUPABASE_URL = 'https://hrnedqrnzqseuuxmegsb.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhybmVkcXJuenFzZXV1eG1lZ3NiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY4NDc5NzgsImV4cCI6MjA1MjQyMzk3OH0.xvlk4y_xDK5UhRo2JUv0QEXD1fFD-f_NsFwfz5TRN0Y';
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    // 2. å®ç°å‘é€æ¶ˆæ¯åŠŸèƒ½
    window.sendMessage = async function() {
        const input = document.getElementById('userInput');
        const chatBox = document.getElementById('chatBox');
        const question = input.value.trim();
        if (!question) return;

        // åœ¨ç•Œé¢æ˜¾ç¤ºç”¨æˆ·é—®é¢˜
        appendMessage('user', question);
        input.value = '';

        // åˆ°æ•°æ®åº“ ai_knowledge_base è¡¨ä¸­æœç´¢åŒ¹é…çš„å†…å®¹
        const { data, error } = await supabase
            .from('ai_knowledge_base')
            .select('content')
            .or(`title.ilike.%${question}%,content.ilike.%${question}%`)
            .limit(1);

        // æ¨¡æ‹Ÿ AI å›å¤å»¶è¿Ÿ
        setTimeout(() => {
            const answer = (data && data.length > 0) 
                ? data[0].content 
                : "æˆ‘æ˜¯ ATMM AI åŠ©æ‰‹ã€‚å…³äºâ€œ" + question + "â€ï¼Œæˆ‘è¿˜åœ¨å­¦ä¹ ä¸­ã€‚æ‚¨å¯ä»¥å°è¯•æ¢ä¸ªå…³é”®è¯ï¼Œæˆ–å’¨è¯¢ç®¡ç†å‘˜ã€‚";
            appendMessage('bot', answer);
        }, 500);
    };

    function appendMessage(role, text) {
        const chatBox = document.getElementById('chatBox');
        const msg = document.createElement('div');
        msg.className = `msg ${role}`;
        msg.textContent = text;
        chatBox.appendChild(msg);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    async function loadNews() {
    const { data, error } = await supabase
        .from('news')
        .select('*')
        .eq('status', 'approved')
        .order('created_at', { ascending: false });

    const newsList = document.getElementById('newsList');
    if (data && data.length > 0) {
        newsList.innerHTML = data.map(item => `
            <div class="news-item" style="padding: 10px; border-bottom: 1px solid #eee;">
                <div class="news-title" style="color: #0072ff; font-weight: bold;">${item.title}</div>
                <div class="news-date" style="font-size: 12px; color: #999;">${new Date(item.created_at).toLocaleDateString()}</div>
            </div>
        `).join('');
    }
}
loadNews(); // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œ
</script>   
</body>
</html>